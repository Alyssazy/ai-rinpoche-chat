<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIä»æ³¢åˆ‡ - æ™ºæ…§å¯¹è¯åŠ©æ‰‹</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 class="title">AIä»æ³¢åˆ‡</h1>
                <p class="subtitle">æ™ºæ…§å¯¹è¯åŠ©æ‰‹ - ä¸ºæ‚¨æä¾›æ·±åº¦æ€è€ƒä¸æŒ‡å¯¼</p>
                <button class="theme-toggle" id="themeToggle">
                    <span class="theme-icon">ğŸŒ™</span>
                </button>
            </div>
        </header>

        <main class="main">
            <div class="chat-container">
                <div class="welcome-message" id="welcomeMessage">
                    <div class="welcome-content">
                        <h2>æ¬¢è¿ä¸AIä»æ³¢åˆ‡å¯¹è¯</h2>
                        <p>ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œå½“å‰è¿è¡Œåœ¨<strong>æ¼”ç¤ºæ¨¡å¼</strong>ä¸‹ã€‚<br>
                        è¦è·å¾—çœŸå®çš„AIå›å¤ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€æ–¹æ¡ˆï¼š</p>
                        
                        <div class="setup-instructions">
                            <div class="instruction-card">
                                <h3>ğŸš€ æ–¹æ¡ˆ1: å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨</h3>
                                <p>åŒå‡»è¿è¡Œ <code>å¯åŠ¨æœåŠ¡å™¨-æ–°ç‰ˆ.bat</code></p>
                                <p>ç„¶åè®¿é—® <code>http://localhost:8000</code></p>
                            </div>
                            
                            <div class="instruction-card">
                                <h3>ğŸŒ æ–¹æ¡ˆ2: Chromeæ— å®‰å…¨æ¨¡å¼</h3>
                                <ol>
                                    <li>å…³é—­æ‰€æœ‰Chromeçª—å£</li>
                                    <li>æŒ‰Win+Rï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</li>
                                    <li><code>chrome --user-data-dir="C:\temp" --disable-web-security</code></li>
                                    <li>åœ¨æ–°æ‰“å¼€çš„Chromeä¸­è®¿é—®æ­¤é¡µé¢</li>
                                </ol>
                            </div>
                        </div>

                        <div class="quick-questions">
                            <button class="quick-btn" data-question="ä»€ä¹ˆæ˜¯çœŸæ­£çš„æ™ºæ…§ï¼Ÿ">ä»€ä¹ˆæ˜¯çœŸæ­£çš„æ™ºæ…§ï¼Ÿ</button>
                            <button class="quick-btn" data-question="å¦‚ä½•é¢å¯¹ç”Ÿæ´»ä¸­çš„å›°éš¾ï¼Ÿ">å¦‚ä½•é¢å¯¹ç”Ÿæ´»ä¸­çš„å›°éš¾ï¼Ÿ</button>
                            <button class="quick-btn" data-question="ä»€ä¹ˆæ˜¯å†…å¿ƒçš„å¹³é™ï¼Ÿ">ä»€ä¹ˆæ˜¯å†…å¿ƒçš„å¹³é™ï¼Ÿ</button>
                        </div>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages"></div>
                
                <div class="chat-loading" id="chatLoading" style="display: none;">
                    <div class="loading-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <span class="loading-text">AIä»æ³¢åˆ‡æ­£åœ¨æ€è€ƒä¸­...</span>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="status-indicator" id="statusIndicator">
                    <span class="status-dot demo"></span>
                    <span class="status-text">æ¼”ç¤ºæ¨¡å¼ - æ¨¡æ‹Ÿå›å¤</span>
                </div>
                <div class="chat-input-wrapper">
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
                        rows="1"
                    ></textarea>
                    <button id="sendButton" class="send-button">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
                <div class="input-footer">
                    <span class="input-hint">æŒ‰ Enter å‘é€ï¼ŒShift + Enter æ¢è¡Œ</span>
                </div>
            </div>
        </main>
    </div>

    <script>
    class AIRinpocheChat {
        constructor() {
            this.apiKey = 'app-vanuZhHLhFmXqz5kG8guNOb7';
            this.apiBase = 'https://api.dify.ai';
            this.conversationId = null;
            this.isLoading = false;
            this.isDemo = true; // å¼ºåˆ¶æ¼”ç¤ºæ¨¡å¼

            this.initializeElements();
            this.bindEvents();
            this.initializeTheme();
            this.loadConversationHistory();
            this.updateStatusIndicator();
        }

        initializeElements() {
            this.chatInput = document.getElementById('chatInput');
            this.sendButton = document.getElementById('sendButton');
            this.chatMessages = document.getElementById('chatMessages');
            this.welcomeMessage = document.getElementById('welcomeMessage');
            this.chatLoading = document.getElementById('chatLoading');
            this.themeToggle = document.getElementById('themeToggle');
            this.quickButtons = document.querySelectorAll('.quick-btn');
            this.statusIndicator = document.getElementById('statusIndicator');
        }

        updateStatusIndicator() {
            const statusDot = this.statusIndicator.querySelector('.status-dot');
            const statusText = this.statusIndicator.querySelector('.status-text');
            
            if (this.isDemo) {
                statusDot.className = 'status-dot demo';
                statusText.textContent = 'æ¼”ç¤ºæ¨¡å¼ - æ¨¡æ‹Ÿå›å¤';
            } else {
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'å·²è¿æ¥ - AIä»æ³¢åˆ‡åœ¨çº¿';
            }
        }

        bindEvents() {
            this.sendButton.addEventListener('click', () => this.sendMessage());
            
            this.chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendMessage();
                }
            });

            this.chatInput.addEventListener('input', () => {
                this.adjustTextareaHeight();
                this.updateSendButtonState();
            });

            this.themeToggle.addEventListener('click', () => this.toggleTheme());

            this.quickButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const question = btn.getAttribute('data-question');
                    this.chatInput.value = question;
                    this.sendMessage();
                });
            });
        }

        initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            this.setTheme(savedTheme);
        }

        toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            this.setTheme(newTheme);
        }

        setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            const themeIcon = this.themeToggle.querySelector('.theme-icon');
            themeIcon.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        adjustTextareaHeight() {
            this.chatInput.style.height = 'auto';
            this.chatInput.style.height = Math.min(this.chatInput.scrollHeight, 120) + 'px';
        }

        updateSendButtonState() {
            const hasText = this.chatInput.value.trim().length > 0;
            this.sendButton.disabled = !hasText || this.isLoading;
        }

        async sendMessage() {
            const message = this.chatInput.value.trim();
            if (!message || this.isLoading) return;

            this.showChatInterface();
            this.addMessage('user', message);
            this.chatInput.value = '';
            this.adjustTextareaHeight();
            this.setLoading(true);

            try {
                const response = await this.getDemoResponse(message);
                this.addMessage('ai', response);
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                this.addMessage('ai', 'æ¼”ç¤ºæ¨¡å¼å‡ºç°é”™è¯¯ã€‚è¯·æ£€æŸ¥æ§åˆ¶å°äº†è§£è¯¦æƒ…ã€‚');
            } finally {
                this.setLoading(false);
            }
        }

        getDemoResponse(message) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const responses = [
                        `å…³äº"${message.substring(0, 20)}${message.length > 20 ? '...' : ''}"çš„é—®é¢˜ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ¼”ç¤ºå›å¤ã€‚è¦è·å¾—çœŸæ­£çš„AIä»æ³¢åˆ‡æ™ºæ…§å›å¤ï¼Œè¯·æŒ‰ç…§é¡µé¢é¡¶éƒ¨çš„è¯´æ˜é…ç½®æœåŠ¡å™¨ç¯å¢ƒã€‚`,
                        `æ‚¨æåˆ°äº†"${message.substring(0, 15)}${message.length > 15 ? '...' : ''}"ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚åœ¨æ¼”ç¤ºæ¨¡å¼ä¸‹ï¼Œæˆ‘åªèƒ½æä¾›é¢„è®¾å›å¤ã€‚è¦ä½“éªŒå®Œæ•´åŠŸèƒ½ï¼Œè¯·å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ã€‚`,
                        `æ„Ÿè°¢æ‚¨çš„æé—®ï¼š"${message.substring(0, 25)}${message.length > 25 ? '...' : ''}"ã€‚è¿™æ˜¯æ¼”ç¤ºæ¨¡å¼çš„å›å¤ã€‚è¦ä¸çœŸæ­£çš„AIä»æ³¢åˆ‡å¯¹è¯ï¼Œè¯·æŒ‰ç…§é¡µé¢æŒ‡å—è®¾ç½®ç¯å¢ƒã€‚`,
                        `æ‚¨çš„é—®é¢˜å¾ˆæœ‰æ·±åº¦ã€‚åœ¨æ¼”ç¤ºæ¨¡å¼ä¸‹ï¼Œæˆ‘æ— æ³•æä¾›çœŸæ­£çš„AIæ™ºæ…§æŒ‡å¯¼ã€‚è¯·å‚è€ƒé¡µé¢ä¸Šçš„è®¾ç½®è¯´æ˜ï¼Œå¯ç”¨å®Œæ•´åŠŸèƒ½åå†æ¬¡æé—®ã€‚`
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    resolve(randomResponse);
                }, 1500 + Math.random() * 2000);
            });
        }

        showChatInterface() {
            this.welcomeMessage.style.display = 'none';
            this.chatMessages.classList.add('active');
            this.chatMessages.style.display = 'block';
        }

        addMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = type === 'user' ? 'ğŸ‘¤' : 'ğŸ§˜';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            const messageText = document.createElement('div');
            messageText.className = 'message-text';
            messageText.textContent = content;
            
            const messageTime = document.createElement('div');
            messageTime.className = 'message-time';
            messageTime.textContent = this.formatTime(new Date());
            
            messageContent.appendChild(messageText);
            messageContent.appendChild(messageTime);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            this.chatMessages.appendChild(messageDiv);
            
            requestAnimationFrame(() => {
                messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            });

            this.saveMessage(type, content);
        }

        setLoading(loading) {
            this.isLoading = loading;
            this.chatLoading.style.display = loading ? 'flex' : 'none';
            this.updateSendButtonState();
            
            if (loading) {
                this.chatLoading.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
        }

        formatTime(date) {
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        saveMessage(type, content) {
            try {
                const savedMessages = sessionStorage.getItem('chatHistory');
                const messages = savedMessages ? JSON.parse(savedMessages) : [];
                
                messages.push({
                    type,
                    content,
                    time: new Date().toISOString()
                });

                if (messages.length > 100) {
                    messages.splice(0, messages.length - 100);
                }
                
                sessionStorage.setItem('chatHistory', JSON.stringify(messages));
            } catch (error) {
                console.error('ä¿å­˜æ¶ˆæ¯å¤±è´¥:', error);
            }
        }

        loadConversationHistory() {
            const savedMessages = sessionStorage.getItem('chatHistory');
            if (savedMessages) {
                try {
                    const messages = JSON.parse(savedMessages);
                    if (messages.length > 0) {
                        this.showChatInterface();
                        messages.forEach(msg => {
                            this.addMessageToUI(msg.type, msg.content, msg.time);
                        });
                    }
                } catch (error) {
                    console.error('åŠ è½½èŠå¤©å†å²å¤±è´¥:', error);
                }
            }
        }

        addMessageToUI(type, content, timeStr) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = type === 'user' ? 'ğŸ‘¤' : 'ğŸ§˜';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            const messageText = document.createElement('div');
            messageText.className = 'message-text';
            messageText.textContent = content;
            
            const messageTime = document.createElement('div');
            messageTime.className = 'message-time';
            messageTime.textContent = this.formatTime(new Date(timeStr));
            
            messageContent.appendChild(messageText);
            messageContent.appendChild(messageTime);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            this.chatMessages.appendChild(messageDiv);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        new AIRinpocheChat();
    });
    </script>

    <style>
    .setup-instructions {
        max-width: 600px;
        margin: 2rem 0;
    }

    .instruction-card {
        background: var(--secondary-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
    }

    .instruction-card h3 {
        color: var(--accent-color);
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
    }

    .instruction-card code {
        background: var(--tertiary-bg);
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
    }

    .instruction-card ol {
        margin: 0.5rem 0;
        padding-left: 1.5rem;
    }

    .instruction-card li {
        margin: 0.3rem 0;
    }

    .status-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
    }

    .status-dot.demo {
        background: #f59e0b;
        animation: pulse 2s infinite;
    }

    .status-dot.connected {
        background: #10b981;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    </style>
</body>
</html>